apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  service.slack: |
    token: $slack-bot-token
  template.app-sync-failed: |
    message: |
      🚨 Sync for application `{{.app.metadata.name}}` has failed.
      Project: {{.app.spec.project}}
      Sync Status: {{.app.status.sync.status}}
      Please investigate: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
  template.app-created: |
    message: |
      ✅ Application `{{.app.metadata.name}}` has been created.
      Project: {{.app.spec.project}}
      See it here: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
  template.app-deleted: |
    message: |
      🗑️ Application `{{.app.metadata.name}}` has been deleted.
      Project: {{.app.spec.project}}
  template.app-restored: |
    message: |
      💚 Application `{{.app.metadata.name}}` has been restored to a Healthy state.
      Project: {{.app.spec.project}}
  template.app-health-degraded: |
    message: |
      💔 Application `{{.app.metadata.name}}` has become Degraded.
      Project: {{.app.spec.project}}
      Please investigate: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
  template.app-out-of-sync: |
    message: |
      ⚠️ Application `{{.app.metadata.name}}` is OutOfSync.
      Project: {{.app.spec.project}}
      Status: Live state does not match the state defined in Git. Self-healing may be in progress.
  
  # --- TRIGGERS ---
  trigger.on-created: |
    - send: [app-created]
  trigger.on-deleted: |
    - send: [app-deleted]
  trigger.on-app-restored: |
    - when: app.status.health.status == 'Healthy'
      send: [app-restored]
  trigger.on-sync-failed: |
    - when: app.status.sync.status == 'OutOfSync' and app.status.health.status == 'Degraded'
      send: [app-sync-failed]
  trigger.on-health-degraded: |
    - when: app.status.health.status == 'Degraded'
      send: [app-health-degraded]
  trigger.on-out-of-sync: |
    - when: app.status.sync.status == 'OutOfSync'
      send: [app-out-of-sync]