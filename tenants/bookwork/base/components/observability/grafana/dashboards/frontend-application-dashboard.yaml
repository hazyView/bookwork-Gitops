---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-frontend-dashboard
  namespace: monitoring
  annotations:
    argocd.argoproj.io/sync-wave: "2"
  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/part-of: bookwork-observability
    grafana_dashboard: "1"
data:
  frontend-application-dashboard.json: |
    {
      "id": null,
      "uid": "bookwork-frontend-app",
      "title": "Bookwork Frontend Application Metrics",
      "tags": ["bookwork", "frontend", "application", "sveltekit"],
      "style": "dark",
      "timezone": "browser",
      "editable": true,
      "graphTooltip": 1,
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
        "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
      },
      "refresh": "30s",
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": "-- Grafana --",
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "panels": [
        {
          "id": 1,
          "title": "Application Health Overview",
          "type": "stat",
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "up{job=\"bookwork-frontend\"}",
              "legendFormat": "Service Up",
              "refId": "A"
            },
            {
              "expr": "sum(rate(request_count{job=\"bookwork-frontend\"}[5m]))",
              "legendFormat": "Request Rate",
              "refId": "B"
            },
            {
              "expr": "sum(rate(error_count{job=\"bookwork-frontend\"}[5m])) / sum(rate(request_count{job=\"bookwork-frontend\"}[5m])) * 100",
              "legendFormat": "Error Rate %",
              "refId": "C"
            },
            {
              "expr": "histogram_quantile(0.95, sum(rate(request_latency_seconds_bucket{job=\"bookwork-frontend\"}[5m])) by (le))",
              "legendFormat": "P95 Latency",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"displayMode": "basic"},
              "mappings": [],
              "thresholds": {
                "steps": [
                  {"color": "green", "value": null},
                  {"color": "red", "value": 80}
                ]
              },
              "unit": "short"
            },
            "overrides": [
              {"matcher": {"id": "byName", "options": "Error Rate %"}, "properties": [{"id": "unit", "value": "percent"}]},
              {"matcher": {"id": "byName", "options": "P95 Latency"}, "properties": [{"id": "unit", "value": "s"}]},
              {"matcher": {"id": "byName", "options": "Request Rate"}, "properties": [{"id": "unit", "value": "reqps"}]}
            ]
          },
          "options": {
            "reduceOptions": {"values": false, "calcs": ["lastNotNull"], "fields": ""},
            "orientation": "auto",
            "textMode": "auto",
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto"
          }
        },
        {
          "id": 2,
          "title": "HTTP Request Rate",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
          "targets": [
            {
              "expr": "sum(rate(request_count{job=\"bookwork-frontend\"}[5m])) by (method)",
              "legendFormat": "{{method}}",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Requests/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 3,
          "title": "Response Time Percentiles",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
          "targets": [
            {
              "expr": "histogram_quantile(0.50, sum(rate(request_latency_seconds_bucket{job=\"bookwork-frontend\"}[5m])) by (le))",
              "legendFormat": "P50",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.95, sum(rate(request_latency_seconds_bucket{job=\"bookwork-frontend\"}[5m])) by (le))",
              "legendFormat": "P95",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.99, sum(rate(request_latency_seconds_bucket{job=\"bookwork-frontend\"}[5m])) by (le))",
              "legendFormat": "P99",
              "refId": "C"
            }
          ],
          "yAxes": [
            {"label": "Response Time", "show": true, "unit": "s"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 2,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 4,
          "title": "Error Rate by Status Code",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 12},
          "targets": [
            {
              "expr": "sum(rate(request_count{job=\"bookwork-frontend\",status=~\"4..\"}[5m])) by (status)",
              "legendFormat": "4xx - {{status}}",
              "refId": "A"
            },
            {
              "expr": "sum(rate(error_count{job=\"bookwork-frontend\"}[5m])) by (status)",
              "legendFormat": "5xx - {{status}}",
              "refId": "B"
            }
          ],
          "yAxes": [
            {"label": "Errors/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {"4xx": "#FF9830", "5xx": "#F2495C"},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": true,
          "percentage": false
        },
        {
          "id": 5,
          "title": "Active Sessions",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
          "targets": [
            {
              "expr": "bookwork_frontend_active_sessions{job=\"bookwork-frontend\"}",
              "legendFormat": "Active Sessions",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Sessions", "show": true, "unit": "short"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 2,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 6,
          "title": "Page Loads",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 20},
          "targets": [
            {
              "expr": "sum(rate(bookwork_frontend_page_loads_total{job=\"bookwork-frontend\"}[5m])) by (page)",
              "legendFormat": "{{page}}",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Page Loads/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 7,
          "title": "Component Load Times",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20},
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(bookwork_frontend_component_load_duration_seconds_bucket{job=\"bookwork-frontend\"}[5m])) by (le, component))",
              "legendFormat": "P95 - {{component}}",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Load Time", "show": true, "unit": "s"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 8,
          "title": "Component Errors",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
          "targets": [
            {
              "expr": "sum(rate(bookwork_frontend_component_errors_total{job=\"bookwork-frontend\"}[5m])) by (component)",
              "legendFormat": "{{component}}",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Errors/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null as zero",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": true,
          "percentage": false
        },
        {
          "id": 9,
          "title": "Cache Performance",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
          "targets": [
            {
              "expr": "sum(rate(bookwork_frontend_cache_hits_total{job=\"bookwork-frontend\"}[5m])) by (cache_type)",
              "legendFormat": "Hits - {{cache_type}}",
              "refId": "A"
            },
            {
              "expr": "sum(rate(bookwork_frontend_cache_misses_total{job=\"bookwork-frontend\"}[5m])) by (cache_type)",
              "legendFormat": "Misses - {{cache_type}}",
              "refId": "B"
            }
          ],
          "yAxes": [
            {"label": "Operations/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {"Hits": "#73BF69", "Misses": "#F2495C"},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 10,
          "title": "Cache Hit Rate",
          "type": "stat",
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 36},
          "targets": [
            {
              "expr": "sum(rate(bookwork_frontend_cache_hits_total{job=\"bookwork-frontend\"}[5m])) / (sum(rate(bookwork_frontend_cache_hits_total{job=\"bookwork-frontend\"}[5m])) + sum(rate(bookwork_frontend_cache_misses_total{job=\"bookwork-frontend\"}[5m]))) * 100",
              "legendFormat": "Hit Rate %",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {
                "steps": [
                  {"color": "red", "value": null},
                  {"color": "yellow", "value": 70},
                  {"color": "green", "value": 85}
                ]
              },
              "unit": "percent"
            }
          },
          "options": {
            "reduceOptions": {"values": false, "calcs": ["lastNotNull"], "fields": ""},
            "orientation": "auto",
            "textMode": "auto",
            "colorMode": "background",
            "graphMode": "area",
            "justifyMode": "auto"
          }
        },
        {
          "id": 11,
          "title": "Rate Limiting Activity",
          "type": "graph",
          "gridPos": {"h": 8, "w": 6, "x": 6, "y": 36},
          "targets": [
            {
              "expr": "sum(rate(bookwork_frontend_rate_limit_hits_total{job=\"bookwork-frontend\"}[5m])) by (endpoint)",
              "legendFormat": "{{endpoint}}",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Rate Limit Hits/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null as zero",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": true,
          "percentage": false
        },
        {
          "id": 12,
          "title": "Security Events",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 36},
          "targets": [
            {
              "expr": "sum(rate(bookwork_frontend_security_events_total{job=\"bookwork-frontend\"}[5m])) by (event_type)",
              "legendFormat": "{{event_type}}",
              "refId": "A"
            }
          ],
          "yAxes": [
            {"label": "Events/sec", "show": true, "unit": "reqps"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null as zero",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": true,
          "percentage": false,
          "alert": {
            "conditions": [
              {
                "evaluator": {"params": [0], "type": "gt"},
                "operator": {"type": "and"},
                "query": {"params": ["A", "5m", "now"]},
                "reducer": {"params": [], "type": "sum"},
                "type": "query"
              }
            ],
            "executionErrorState": "alerting",
            "for": "0m",
            "frequency": "10s",
            "handler": 1,
            "name": "Security Events Alert",
            "noDataState": "no_data",
            "notifications": []
          }
        },
        {
          "id": 13,
          "title": "System Resources",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 44},
          "targets": [
            {
              "expr": "rate(bookwork_frontend_process_cpu_seconds_total{job=\"bookwork-frontend\"}[5m]) * 100",
              "legendFormat": "CPU Usage %",
              "refId": "A"
            },
            {
              "expr": "bookwork_frontend_process_resident_memory_bytes{job=\"bookwork-frontend\"} / 1024 / 1024",
              "legendFormat": "Memory Usage MB",
              "refId": "B"
            }
          ],
          "yAxes": [
            {"label": "Usage", "show": true, "unit": "short"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        },
        {
          "id": 14,
          "title": "Garbage Collection",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 44},
          "targets": [
            {
              "expr": "rate(bookwork_frontend_nodejs_gc_duration_seconds_total{job=\"bookwork-frontend\"}[5m])",
              "legendFormat": "GC Duration",
              "refId": "A"
            },
            {
              "expr": "rate(bookwork_frontend_nodejs_eventloop_lag_seconds{job=\"bookwork-frontend\"}[5m])",
              "legendFormat": "Event Loop Lag",
              "refId": "B"
            }
          ],
          "yAxes": [
            {"label": "Duration", "show": true, "unit": "s"},
            {"show": false}
          ],
          "xAxis": {"show": true},
          "legend": {"show": true, "values": false, "min": false, "max": false, "current": false, "total": false, "avg": false},
          "nullPointMode": "null",
          "steppedLine": false,
          "tooltip": {"shared": true, "sort": 0, "value_type": "individual"},
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "fill": 1,
          "linewidth": 1,
          "points": false,
          "renderer": "flot",
          "spaceLength": 10,
          "stack": false,
          "percentage": false
        }
      ]
    }
